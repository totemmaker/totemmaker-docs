# [14] Line follower module

**Features:**  

- White/Black line position detection  
- Junction detection  
- Automatic line color detection  
- Automatic contrast calibration  

**Arduino example:** [14_lineFollower.ino](https://github.com/totemmaker/TotemArduino/tree/master/examples/Module/14_lineFollower/14_lineFollower.ino){target=_blank}

```arduino
TotemModule module(14);
```

![Totem Module 14](/assets/images/module_14.jpg){style="display: block;margin-left: auto;margin-right: auto;"}

## Module commands

--8<-- "includes/command_notes.md"

### Line

#### line/junction ( )

: Line junction detection feature allows to detect horizontal lines in its follow path. This is used for invoking some kind of action or to change direction (turn robot left or right).  
_Returns:_ sensor is reading horizontal line [`true`:`false`].  

```arduino
bool junction = module.readWait("line/junction").getInt();
module.subscribe("line/junction"); // Will send event onModuleData when junction is detected
```

#### line/color ( )

: Currently detected line color. This can be White or Black. If color is not detected - `0` is returned. Color is returned in [ASCII](https://www.asciitable.com) character. Use `'W'`, `'B'` expression.  
_Returns:_ detected line color [`W`;`B`;`false`]. `false` - not detected.  

```arduino
int lineColor = module.readWait("line/color").getInt();
if (lineColor == 'W') {} // White
else if (lineColor == 'B') {} // Black
else { } // Not detected
```

#### line/pos ( )

: Line position below sensor. (negative, 0, positive) = (left, center, right).  
_Returns:_ position [`-35`:`35`]. `0` - center.  

```arduino
int position = module.readWait("line/pos").getInt();
```

***

### LED

#### led (&nbsp;`state`&nbsp;)

: Control red LED bar.  
Each bit in 12bit value represents individual on-board LED. 1 - on, 0 - off.  
_This command disables line detection displaying. To re-enable - write `-1`._  
_Parameter:_  
`state` - [`B00000000`:`B11111111`].  

```arduino
module.write("led", B11110000); // Set leds A,B,C,D on
```

***

### Sensor

#### sensor/threshold (&nbsp;`contrast`&nbsp;)

: Minimum contrast difference between line and ground required to start detection.  
Lower value means more sensitivity when detecting line, but more susceptible to noise and misreadings. Should be changed only when there is an issue with detection on particular surface.  
_Parameter:_  
`contrast` - detection start range [`10`:`80`]%.  
Default value: `20`.  

```arduino
module.write("sensor/threshold", 20);
```

#### sensor/range ( )

: Percentage of current contrast difference between line and ground (maximum values).  
Higher value means better detection accuracy. If value is lower than `sensor/threshold`, sensor won't be able to work properly. In this case lower `sensor/threshold` value or improve surface contrast.  
_Returns:_ current contrast difference [`0`:`100`]%.  

```arduino
int range = module.readWait("sensor/range").getInt();
```

#### sensor/raw ( )

: Returns 8 byte array of contrast reading from each sensor.  
0% - light does not reflect (black), 100% - light does reflect (white).  
Array index 0 corresponds to sensor A, 1 - B, ...  
_Returns:_ 8 byte array of each sensor contrast [`0`:`100`]%.  

```arduino
Data data = module.readWait("sensor/raw");
uint8_t *contrast; // Get pointer to data array
data.getData(contrast);
// Print data array
for (int i=0; i<8; i++) {
    Serial.print(contrast[i]);
    Serial.print(" ");
}
Serial.println();
```
